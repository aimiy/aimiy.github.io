---
layout: post
title:  canvas基础绘图
date:   2017-12-13 17:30:00 +0800
categories: notes
tag: canvas
---

* content
{:toc}


# 创建canvas并选择
html内创建canvas
```
<canvas id="c" width="200" height="200"></canvas>
```
选择该canvas，并通过getcontext方法获取绘图环境，当传入“2d”属性的时候，我们获取到的是2d的canvas，同理我们也可以获取3d的canvas。
```
var c = document.querySelector("#c");
var ctx = c.getContext("2d");
```
# 绘制图片
新建image对象，设置其路径image.src。
```
var image = new Image();
image.src = "p.png";
```
js中图片的加载是异步的，所以我们针对图片所做的操作必须在图片加载完成后，因此需要在image对象上设置好onload函数。
```
image.onload = function() {
console.log("Loaded image");
ctx.drawImage(image,0,0,c.width,c.height);
}
```
函数中，我们使用了canvas的drawimage方法，传入图片本身，图片起始的坐标，图片的宽高，即可绘制一张图片。

# 保存图片
我们使用选择器获取该canvas，然后使用todataurl方法存储图片，使用window.open即可从一个新窗口打开图片。

```
var savedImage = c.toDataURL();
window.open(savedImage);
```
注意：需要在安全的服务器上才能运行，也就是要你自己在本地或者线上搭建服务器。

## 创建本地的web服务器

### 使用 Python SimpleHTTPServer

Windows, Mac, Linux
点击此处下载https://www.python.org/downloads/（或许你已经安装了）

你需要的只有 Python 和命令行。Mac 和 Linux 中自带 Python，但 Windows 用户需要下载。Python 主要有两个版本： Python 2 和 Python 3。两者都非常适合设置一个简单的服务器。

**说明**

打开终端（Mac 和 Linux） 或命令行（Windows）。
通过 cd 进入到你保存 HTML 文件的目录。例如，cd ~/Documents/mysite/。（对于 Mac 和 Linux， 如果你不熟悉终端，可以查看更多关于 cd 的说明。Windows 下，查看更多关于 cd 的说明）。

输入 python --version。如果已安装 Python，你将会看到“ Python X.Y.Z ”。“ X ”可能是 2 或者 3，代表 Python 2 或 Python 3。如果没有显示或命令产生错误，我建议你下载 Python。

如果你安装的是 Python 2，输入 python -m SimpleHTTPServer 8000。如果你安装的是 Python 3， 输入python -m http.server 8000。

在你的浏览器中访问 http://localhost:8000/。如果在你的目录中存在一个名为 index.html 的文件，它将自动显示。如果不存在，你应该能看到该目录下的文件。点击 HTML 文件并加载。恭喜！你有了一台正在运行的服务器。
（什么是 8000？它是一个网络端口，计算机用此来组织其网络流量。）

### MAMP
Windows 和 Mac
点击此处下载https://www.mamp.info/en/（免费版本即可）
这是一个简单的 GUI，用于提供目录。

**安装**

查看 MAMP 网站的安装说明。

### Node
Windows，Mac，Linux
需要 Node 和 npm（随 node 一起安装）
与上面利用 Python的方法相似，这里利用一个简单的命令行工具。这种方法使用 Node，这是一个流行的 JavaScript 运行环境（即在浏览器之外可以运行任意的 JavaScript 代码）。Node 在一些应用上，非常受欢迎，包括服务器。虽然 Node 很少在前端开发中出现，但是每个 Web 开发人员都可能见过它的包管理工具 npm。npm（Node Package Manager） 是一个命令行工具，可以轻松地安装和管理其他命令行工具，库和框架。

这种方法所需的安装时间可能比 Python 要多，但值得尝试，这样你对 npm 的学习有了良好的开始。话虽如此，如果你尝试利用这种方法，却遇到了问题，这不算什么 —— 使用其他方法就好了。

**安装**

在终端或命令行中输入 node --version。如果没有内容显示或显示错误，安装 Node。

输入 npm install -g http-server。

通过输入 http-server ~/Documents/mysite -p 8000 提供文件（将 ~/Documents/mysite 替换为你的项目目录的路径）

在你的浏览器中访问http://localhost:8000，进行测试。


# 绘制
## 绘制矩形
空心矩形
```
ctx.strokeRect(50,50,100,100);
```
起始坐标点，宽，高

实心矩形
```
ctx.fillRect(50,50,100,100);
```

## 绘制圆
```
arc(x,y,r,start,stop);
```


## 设置颜色
```
ctx.fillStyle = "blue";
ctx.strokeStyle = "green";
```
fill使用fill的颜色，stroke使用stroke的颜色。
## 擦除画布
```
ctx.clearRect(0,0,25,25);
```
如果你想要擦除整个画布，则可以调用 clearRect，将参数设置为画布的尺寸，如下所示：
```
ctx.clearRect(0, 0, c.width, c.height);
```
一种更便捷的清除整个画布的方式是更改画布上的高度或宽度：
```
c.width = c.width;
```
## 绘制路径

```
ctx.beginPath();
ctx.moveTo(75,75);
ctx.lineTo(125,75);
ctx.lineTo(125,125);
ctx.fillStyle = "aqua";
ctx.fill();
```
括号里都是目标坐标点。

beginPath()表示开始绘制路径，moveto表示笔开始的点，但没有痕迹，lineto表示从笔的落点开始向目标坐标点画直线。

# 书写
```
fillText("text",x,y)
strokeText("text",x,y)
```
实心/空心字体
```
context.font = "bold 12px sans-serif";
```
定义字体

```
context.textBaseline = "top";
```
定义文本基线
```
context.textAlign = "right";
```
根据锚点，设置或返回文本内容的当前对齐方式

# 移动画布中的对象
## 缩放
```
ctx.scale(x,y);
```
将x和y都乘以系数
## 移动
```
ctx.translate(x,y)
```
将所有后续命令水平移动x，垂直移动y。
## 旋转
```
ctx.rotate(angleRadians) 
```
将对象绕中心旋转特定弧度。
弧度公式为：
radians = degrees * (Math.PI/180)


**注意**在你撤销之前，任何转换都适用于所有后续对象

# 渐变
## 创建线条渐变
```
// 创建渐变
var grd=ctx.createLinearGradient(0,0,200,0);
grd.addColorStop(0,"red");
grd.addColorStop(1,"white");
 
// 填充渐变
ctx.fillStyle=grd;
ctx.fillRect(10,10,150,80);
```
addColorStop()方法指定颜色停止，参数使用坐标来描述，可以是0至1。
使用渐变，设置fillStyle或strokeStyle的值为 渐变，然后绘制形状，如矩形，文本，或一条线。

## 创建一个径向/圆渐变
```
// 创建渐变
var grd=ctx.createRadialGradient(75,50,5,90,60,100);
grd.addColorStop(0,"red");
grd.addColorStop(1,"white");
 
// 填充渐变
ctx.fillStyle=grd;
ctx.fillRect(10,10,150,80);
```

# 保存和恢复画布状态
每个画布对象都包含一个绘制状态的堆栈。堆栈是一种数据结构，仅让你在一端添加新项。在取出时，将得到最后添加的项目，即“后进先出”(LIFO)。

```
var c = document.querySelector("#c");
var ctx = c.getContext("2d");

ctx.fillStyle = "blue";
ctx.fillRect(0,0,50,50);

ctx.fillStyle = "green"
ctx.fillRect(100,100,10,10);

ctx.fillStyle = "blue";
ctx.fillRect(200,10,20,20);
```
当使用save与restore时
```
var c = document.querySelector("#c");
var ctx = c.getContext("2d");

ctx.fillStyle = "blue";
ctx.fillRect(0,0,50,50);

// 保存蓝色填充的状态
ctx.save();
ctx.fillStyle = "green";
ctx.fillRect(100,100,10,10);
// 恢复蓝色填充的状态
ctx.restore();

ctx.fillRect(200,10,20,20);
```
除此之外，还可以存储
- 当前转换矩阵（旋转、缩放、移动）
- strokeStyle
- fillStyle
- font
- globalAlpha
- lineWidth
- lineCap
- lineJoin
- miterLimit
- shadowOffsetX
- shadowOffsetY
- shadowBlur
- shadowColor
- globalCompositeOperation
- textAlign
- textBaseline
- 当前剪辑区域
