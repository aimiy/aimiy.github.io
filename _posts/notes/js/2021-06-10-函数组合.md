---
layout: post
title:  函数组合
date:   2021-06-10 11:00:00 +0800
categories: 笔记
tag: 函数式编程
---
* content
{:toc}

## 函数组合

纯函数和柯里化很容易写出洋葱代码`f(g(h(x)))`。
函数组合可以让我们把细粒度的函数重新组合成一个新的函数。

如果一个函数要经过多个函数的处理才能得到最终值，这个时候可以把中间过程合并成一个函数。

函数组合默认是从右到左执行。

```js
    function compose(f, g) {
        return function (val) {
            return f(g(val))
        }
    }

    function reverse(array) {
        return array.reverse();
    }
    function first(array) {
        return array[0];
    }

    const last = compose(first, reverse);
    console.log(last(["a", "b"]))
```

讲很多已有的函数，组合成我们想要的样子

### lodash的函数组合

`_.flowRight`

### 原理模拟

```js
    // function compose(...args) {
    //     return function (val) {
    //         return args.reverse().reduce((total, currentFunc) => {
    //             return currentFunc(total)
    //         }, val)
    //     }
    // }

    // reduce() 方法接收一个函数作为累加器，数组中的每个值（从左到右）开始缩减，最终计算为一个值。
    // reduce() 可以作为一个高阶函数，用于函数的 compose。
    // 注意: reduce() 对于空数组是不会执行回调函数的。

    const compose = (...args) => (val) => args.reverse().reduce((total, currentFunc) => currentFunc(total), val)

    const reverse = (array) => array.reverse();
    const first = (array) => array[0];
    const toUpper = str => str.toUpperCase();

    const last = compose(toUpper, first, reverse);
    console.log(last(["a", "b"]))
```

### 结合律

函数组合需要满足结合律compose(f,compose(g,h))与compose(compose(f,g),h)结果相同

### 如何调试组合函数

在函数组合中的函数，写一个log函数，打印结果并传给下一个函数。

```js
const log = v => {
    console.log(v)
    return v;
}

```

但是多次插入log会使打印结果不清晰

```js
const trace = _.curry((tag,v) => {
    console.log(tag,v)
    return v;
})

```
