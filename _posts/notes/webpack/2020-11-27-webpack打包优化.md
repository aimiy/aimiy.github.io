---
layout: post
title:  webpack打包优化
date:   2020-11-27 16:45:00 +0800
categories: 笔记
tag: webpack
---

* content
{:toc}



# 配置resolve.mudules

## 原理
`resolve.modules`告诉 webpack 解析模块时应该搜索的目录。

绝对路径和相对路径都能使用，但是要知道它们之间有一点差异。

通过查看当前目录以及祖先路径（即 `./node_modules`, `../node_modules` 等等），相对路径将类似于 Node 查找 `'node_modules'` 的方式进行查找。使用绝对路径，将只在给定目录中搜索。

resolve.modules 默认为:`modules: ["node_modules"]`

如果你想要添加一个目录到模块搜索目录，此目录优先于 `node_modules/` 搜索：
例如：

```js
modules: [path.resolve(__dirname, "src"), "node_modules"]
```

>（1）当 js 里出现 import 'vue' 这样不是相对、也不是绝对路径的写法时，它便会到 node_modules 目录下去找。
>（2）在默认配置下，webpack 会采用向上递归搜索的方式去寻找。但通常项目目录里只有一个 node_modules，且是在项目根目录。为了减少搜索范围，可我们以直接写明 node_modules 的全路径。

## 工程里添加

```js
resolve: {
    extensions: ['.js', '.vue', '.json'],
    modules: [path.resolve(__dirname, "src"), "node_modules"],
    alias: {
      'vue$': 'vue/dist/vue.esm.js',
      '@': resolve('src'),
    }
  },
```

# 配置装载机的 include & exclude

## 原理
>（1）webpack 的装载机（loaders）里的每个子项都可以有 include 和 exclude 属性：
include：导入的文件将由加载程序转换的路径或文件数组（把要处理的目录包括进来）
exclude：不能满足的条件（排除不处理的目录）

>（2）我们可以使用 include 更精确地指定要处理的目录，这可以减少不必要的遍历，从而减少性能损失。

>（3）同时使用 exclude 对于已经明确知道的，不需要处理的目录，予以排除，从而进一步提升性能。

## 操作
```js
module: {
    rules: [
      {
        test: /\.vue$/,
        loader: 'vue-loader',
        options: vueLoaderConfig
      },
      {
        test: /\.js$/,
        loader: 'babel-loader',
        include: [resolve('src'), resolve('test'), resolve('node_modules/webpack-dev-server/client')],
        exclude: /node_modules/
      },
```

# 使用 webpack-parallel-uglify-plugin 插件来压缩代码

## 原理
>（1）默认情况下 webpack 使用 UglifyJS 插件进行代码压缩，但由于其采用单线程压缩，速度很慢。

>（2）我们可以改用 `webpack-parallel-uglify-plugin` 插件，它可以并行运行 UglifyJS 插件，从而更加充分、合理的使用 CPU 资源，从而大大减少构建时间。

## 操作
在项目中安装依赖
```nodejs
npm i webpack-parallel-uglify-plugin
```
修改prod.conf.js文件
```js
const ParallelUglifyPlugin = require('webpack-parallel-uglify-plugin');

//...

// 注释掉已有的UglifyJsPlugin，用ParallelUglifyPlugin替代
    // new UglifyJsPlugin({
    //   uglifyOptions: {
    //     compress: {
    //       warnings: false
    //     }
    //   },
    //   sourceMap: config.build.productionSourceMap,
    //   parallel: true
    // }),
    new ParallelUglifyPlugin({
      cacheDir: '.cache/',
      uglifyJS:{
        output: {
          comments: false
        },
        warnings: false
      }
    }),
```

# 使用externals将固定依赖以外部形式




参考:

[webpack](https://www.webpackjs.com/configuration/resolve/#resolve-modules)

[Vue.js - 提高项目build打包速度（webpack构建性能优化技巧汇总）](https://www.hangge.com/blog/cache/detail_2105.html)