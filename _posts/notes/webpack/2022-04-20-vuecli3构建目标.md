---
layout: post
title:  vuecli3构建目标
date:   2021-01-21 11:00:00 +0800
categories: 笔记
tag: vuecli3,webpack
---
* content
{:toc}

最近将公司脚手架升级到3，顺便做一下记录

## 构建库library

## 优化

### 按需使用element

官网的babel是可行的，打包出来的min.js从1077kb变为713kb

按需引入
借助 babel-plugin-component，我们可以只引入需要的组件，以达到减小项目体积的目的。

首先，安装 babel-plugin-component：

```npm
npm install babel-plugin-component -D
```

然后，将 .babelrc 修改为：

```.babelrc
{
  "presets": [["es2015", { "modules": false }]],
  "plugins": [
    [
      "component",
      {
        "libraryName": "element-ui",
        "styleLibraryName": "theme-chalk"
      }
    ]
  ]
}
```

接下来，如果你只希望引入部分组件，比如 Button 和 Select，那么需要在 main.js 中写入以下内容：

```vue
import Vue from 'vue';
import { Button, Select } from 'element-ui';
import App from './App.vue';

Vue.component(Button.name, Button);
Vue.component(Select.name, Select);
/* 或写为

* Vue.use(Button)
* Vue.use(Select)
 */

new Vue({
  el: '#app',
  render: h => h(App)
});
```

[element官网链接](https://element.eleme.cn/#/zh-CN/component/quickstart)

### fonts 内联

打包出来字体类的静态资源并没有打包进js中，还是以单独文件夹的形式引入到代码里。
在插件js提供给第三方后，字体资源会跨域，不方便

查看过别人的博客[静态资源内联](https://blog.csdn.net/kaimo313/article/details/106972917/)，vuecli2中使用url-loader可以内联。[于是根据vuecli3文档](https://cli.vuejs.org/zh/guide/webpack.html#修改-loader-选项)，摸索了一下，配置如下

```js
chainWebpack: config => {
    config.module
    .rule('fonts')
      .test(/\.(svg|ttf|eot|woff|woff2)$/)
      .use('url-loader')
      .loader('url-loader')
      .tap(options => {
        options.name = '[name].[hash:8].[ext]'
        options.limit=999999999
        return options
      })
      .end()
  }
```

limit是必须的，目前感觉是因为默认超过一定限度才不会去内联字体