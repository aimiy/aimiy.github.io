---
layout: post
title:  omit.jsæºç é˜…è¯»
date:   2022-11-16 11:00:00 +0800
categories: ç¬”è®°
tag: æºç å…±è¯»
---
* content
{:toc}

æœ¬æ–‡å‚åŠ äº†ç”±å…¬ä¼—å·[@è‹¥å·è§†é‡](https://lxchuan12.gitee.io/) å‘èµ·çš„æ¯å‘¨æºç å…±è¯»æ´»åŠ¨ï¼Œ [ç‚¹å‡»äº†è§£è¯¦æƒ…ä¸€èµ·å‚ä¸](https://juejin.cn/post/7079706017579139102)ã€‚
è¿™æ˜¯æºç å…±è¯»çš„ç¬¬36æœŸï¼Œé“¾æ¥ï¼š<https://juejin.cn/post/7118782469360320542>ã€‚

## omit.js å‰”é™¤å¯¹è±¡ä¸­çš„å±æ€§

æºç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„

```js
function omit(obj, fields) {
  // eslint-disable-next-line prefer-object-spread
  const shallowCopy = Object.assign({}, obj);
  for (let i = 0; i < fields.length; i += 1) {
    const key = fields[i];
    delete shallowCopy[key];
  }
  return shallowCopy;
}

export default omit;
```

é€šè¿‡`Object.assign()`å°†ä¼ å…¥å¯¹è±¡çš„å€¼æ‹·è´åˆ°æ–°çš„ç©ºå¯¹è±¡ä¸­ï¼Œå†å¯¹æ–°ç›®æ ‡å¯¹è±¡è¿›è¡Œå‰”é™¤å…ƒç´ çš„å¤„ç†ã€‚

### Object.assignæ·±æµ…æ‹·è´

è¿™é‡Œæ³¨æ„åˆ°shallowCopyæ˜¯æµ…æ‹·è´çš„æ„æ€ã€‚ä½†æ˜¯ç ”ç©¶äº†ä¸‹ï¼Œ

Object.assignæ˜¯æµ…æ‹·è´è¿˜æ˜¯æ·±æ‹·è´çš„é—®é¢˜
å³ï¼šç¬¬ä¸€çº§å±æ€§æ·±æ‹·è´ï¼Œä»ç¬¬äºŒçº§å±æ€§å¼€å§‹å°±æ˜¯æµ…æ‹·è´ã€‚

```js
//ç¤ºä¾‹1  ä¸€å±‚æ·±æ‹·è´
let obj = {a:1}
let newObj = Object.assign({},obj);
console.log(newObj); //{a: 1}
newObj.a=2;
console.log(obj); //{a:1}
console.log(newObj); //{a: 2}
 
 
//ç¤ºä¾‹2  äºŒå±‚æµ…æ‹·è´
let obj = {a:1,b:{name:"zhangsan"}}
let newObj = Object.assign({},obj);
console.log(newObj); //{a:1,b:{name:"zhangsan"}}
newObj.b.name="lisi";
console.log(obj); //{a:1,b:{name:"lisi"}}
console.log(newObj); //{a:1,b:{name:"lisi"}}
```

ä¸å…¨æ˜¯

```js
let s = { a: { b: 1 }, c: 1 }
let target = Object.assign({}, s)
console.log(target) // { a: { b: 1 }, c: 1 }

s.a.b = 2
s.c = 3
console.log(s) // { a: { b: 2 }, c: 3 }
console.log(target) // { a: { b: 2 }, c: 1 }
```

**æ€»çš„æ¥è¯´ï¼š**
`Object.assign()`æ‹·è´çš„æ˜¯å±æ€§å€¼ï¼Œå¦‚æœæºå¯¹è±¡çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œé‚£ä¹Ÿåªæ‹·è´é‚£ä¸ªæŒ‡é’ˆã€‚

æ‰€ä»¥å¦‚æœå¯¹è±¡çš„å±æ€§å€¼ä¸ºåŸºç¡€ç±»å‹ï¼Œé€šè¿‡Object.assign()æ‹·è´çš„é‚£ä¸ªå±æ€§è€Œè¨€æ˜¯æ·±æ‹·è´ã€‚

å¦‚æœå¯¹è±¡çš„å±æ€§å€¼ä¸ºå¼•ç”¨ç±»å‹ï¼Œé€šè¿‡Object.assign()æ‹·è´çš„é‚£ä¸ªå±æ€§è€Œè¨€æ˜¯æµ…æ‹·è´ã€‚

## ä¾èµ–æµè§ˆ

æ•´ä¸ªé¡¹ç›®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŸ¥çœ‹å¦‚ä½•æ­å»ºå‘å¸ƒnpmåŒ…ã€‚
æŸ¥çœ‹ç›¸å…³çš„ä¾èµ–

```json
"devDependencies": {
    "@umijs/fabric": "^2.2.2",
    "assert": "^1.4.1",
    "eslint": "^7.4.0",
    "father": "^2.29.5",
    "np": "^6.3.1",
    "rc-tools": "^6.3.3"
  }
```

### @umijs/fabric

åˆæ­¥çœ‹æ¥æ˜¯ä¸€ä¸ªæ§åˆ¶ç¼–ç è§„èŒƒçš„å·¥å…·ã€‚
>readmeæ¯”è¾ƒçŸ­ï¼Œå¤åˆ¶è¿‡æ¥ã€‚

ä¸€ä¸ªåŒ…å« prettierï¼Œeslintï¼Œstylelint çš„é…ç½®æ–‡ä»¶åˆé›†

A collection of configuration files containing prettier, eslint, stylelint

#### Use

å®‰è£…

```bash
npm i @umijs/fabric --save-dev
yarn add @umijs/fabric -D
```

in `.eslintrc.js`

```js
module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/eslint')],

  // in antd-design-pro
  globals: {
    ANT_DESIGN_PRO_ONLY_DO_NOT_USE_IN_YOUR_PRODUCTION: true,
    page: true,
  },

  rules: {
    // your rules
  },
};
```

in `.stylelintrc.js`

```js
module.exports = {
  extends: [require.resolve('@umijs/fabric/dist/stylelint')],
  rules: {
    // your rules
  },
};
```

in `.prettierrc.js`

```js
const fabric = require('@umijs/fabric');

module.exports = {
  ...fabric.prettier,
};
```

### assert

![assert](/styles/images/2022/assert.png)

### eslint

ä»£ç è§„èŒƒï¼Œä¸èµ˜è¿°

### father

![father](/styles/images/2022/father.png)

fatherå¹¶ä¸æ˜¯ä¸€ä¸ªæµ‹è¯•åŒ…ï¼Œåˆæ­¥çœ‹æ¥æ˜¯ä¸€ä¸ªåŠŸèƒ½æ¯”è¾ƒå¼ºå¤§çš„npmåŒ…ç ”å‘å·¥å…·ã€‚

### np

npæ˜¯ä¸€ä¸ªå‘å¸ƒnpmåŒ…çš„å·¥å…·

### rc-tools

## å…³æ³¨æ€ä¹ˆå‘å¸ƒnpmåŒ…çš„ã€commonjsã€esmã€æµ‹è¯•ç”¨ä¾‹ ã€ts ç­‰

å‘ç°éƒ½æ˜¯é€šè¿‡fatheræ¥ç®¡ç†é¡¹ç›®

é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯`"father": "^2.29.5",`ç‰ˆæœ¬ï¼Œäºæ˜¯æŸ¥çœ‹2åˆ†æ”¯
![father2](/styles/images/2022/father2.png)

ä½†æˆ‘ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬è¯•è¯•ï¼Œè¾¹çœ‹[fatheræ–‡æ¡£æŒ‡å—](https://github.com/umijs/father/blob/4a33fd40dd9afdfce957d08dcc61123f9eafb189/docs/guide/index.md)è¾¹ç®¡ç†å‘å¸ƒä¸€ä¸ªåŒ…

### é€šè¿‡ create-father å¿«é€Ÿåˆ›å»ºä¸€ä¸ª father é¡¹ç›®

```bash
npx create-father omit-f.js
```

é€‰æ‹©äº†ä¸€ç³»åˆ—npmåŒ…çš„é…ç½®åï¼Œè‡ªåŠ¨ç”Ÿæˆäº†ç›®å½•

![fatherlog](/styles/images/2022/fatherlog.png)

### å¼€å‘omit

æˆ‘ç›´æ¥å°†æºç ä¸­çš„index.jsä¸index.d.tsé‡Œé¢çš„å˜é‡å£°æ˜ï¼Œèåˆä¸ºä¸€ä¸ªtsï¼Œsrc/index.ts

```ts
function omit<T, K extends keyof T>(obj: T, fields: Array<K>): Omit<T, K> {
    const shallowCopy = Object.assign({}, obj);
    for (let i = 0; i < fields.length; i += 1) {
        const key = fields[i];
        delete shallowCopy[key];
    }
    return shallowCopy;
}

export default omit;
```

### å®æ—¶ç¼–è¯‘äº§ç‰©

æ‰§è¡Œ dev å‘½ä»¤ï¼Œå¼€å¯å®æ—¶ç¼–è¯‘

```bash
father dev // npm run dev
```

ä¸€æ—¦æºç æˆ–é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œäº§ç‰©å°†ä¼šå®æ—¶å¢é‡ç¼–è¯‘åˆ°è¾“å‡ºç›®å½•ã€‚

æ³¨ï¼šç›®å‰ä»… Bundless æ¨¡å¼æ”¯æŒå®æ—¶ç¼–è¯‘

```bash
 *  æ­£åœ¨æ‰§è¡Œä»»åŠ¡: npm run dev 


> omit-f.js@0.0.1 dev
> father dev

info  - Clean output directories
info  - Bundless for src directory to cjs format
event - Bundless src/index.ts to dist\cjs\index.js (with declaration)
event - Generate declaration file...
event - Start watching src directory...
event - Bundless src\index.ts to dist\cjs\index.js (with declaration)
event - Generate declaration file...
```

ç›´æ¥ç›‘å¬srcç›®å½•åšå®æ—¶ç¼–è¯‘ã€‚

### æ„å»º

æŸ¥çœ‹fatherçš„æ–‡æ¡£

#### Bundlessæ¨¡å¼
>
>Bundless å³æ–‡ä»¶åˆ°æ–‡ä»¶çš„æ„å»ºæ¨¡å¼ï¼Œå®ƒä¸å¯¹ä¾èµ–åšä»»ä½•å¤„ç†ï¼Œåªå¯¹æºç åšå¹³è¡Œç¼–è¯‘è¾“å‡ºã€‚ç›®å‰ç¤¾åŒºé‡Œçš„ [tsc](https://www.typescriptlang.org/docs/handbook/compiler-options.html)ã€[unbuild](https://github.com/unjs/unbuild) åŠæ—§ç‰ˆ father çš„ babel æ¨¡å¼éƒ½æ˜¯å¯¹æºç åš Bundless æ„å»ºçš„æ„å»ºå·¥å…·ã€‚
åœ¨ father 4 ä¸­ï¼Œè¾“å‡º ESModule äº§ç‰©å’Œ CommonJS äº§ç‰©æ—¶éƒ½ä¼šé‡‡ç”¨ Bundless æ„å»ºæ¨¡å¼ï¼Œæ¥çœ‹ä¸€ä¸‹ father çš„ Bundless æ„å»ºæ¨¡å¼ä¼šå¦‚ä½•å·¥ä½œã€‚
å‡å®šæœ‰è¿™æ ·çš„æºç ç»“æ„ï¼š

```bash
.
â””â”€â”€ src
    â”œâ”€â”€ index.less
    â”œâ”€â”€ index.tsx
    â””â”€â”€ util.js
```

>é…åˆä»¥ä¸‹æ„å»ºé…ç½®ï¼š

```js
export default {
  esm: { output: 'dist' },
  // æˆ–è€…
  cjs: { output: 'dist' },
};
```

>åˆ™ä¼šè¢« father è¾“å‡ºä¸ºï¼š

```bash
.
â””â”€â”€ dist
    â”œâ”€â”€ index.d.ts
    â”œâ”€â”€ index.js
    â”œâ”€â”€ index.less
    â””â”€â”€ util.js
```

>å¯ä»¥å‘ç°ï¼Œåœ¨ Bundless æ¨¡å¼ä¸‹ï¼Œfather å¯¹æºç çš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š

>1. TypeScript æ¨¡å—ä¼šè¢«ç¼–è¯‘ä¸º JavaScript æ¨¡å—ï¼Œå¹¶ä¸”è¾“å‡ºå¯¹åº”çš„ `.d.ts` ç±»å‹æ–‡ä»¶
>2. JavaScript æ¨¡å—ä¼šè¢«ç¼–è¯‘ä¸º JavaScript æ¨¡å—ï¼Œåšå…¼å®¹æ€§å¤„ç†
>3. å…¶ä»–æ¨¡å—ä¼šè¢«ç›´æ¥æ‹·è´è¾“å‡ºï¼Œä¸åšç¼–è¯‘

#### å¦‚ä½•é€‰æ‹©Bundlessæ¨¡å¼

>Bundless æ¨¡å¼ä¸‹çš„äº§ç‰©å¯ä»¥è¢«é¡¹ç›®é€‰æ‹©æ€§å¼•å…¥ï¼ŒåŒæ—¶ä¹Ÿå…·å¤‡æ›´å¥½çš„å¯è°ƒè¯•æ€§ã€‚å¯¹äºå¤§éƒ¨åˆ†é¡¹ç›®è€Œè¨€ï¼ŒBundless åº”è¯¥éƒ½æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œè¿™ä¹Ÿæ˜¯ç¤¾åŒºå¤§éƒ¨åˆ†é¡¹ç›®çš„é€‰æ‹©ã€‚

#### Bundlessæ¨¡å¼ä¸‹çš„ESModule ä¸ CommonJS äº§ç‰©

> åœ¨ father é¡¹ç›®ä¸­ï¼ŒESModule äº§ç‰©æ„å»ºä¸ CommonJS äº§ç‰©æ„å»ºç±»ä¼¼ï¼Œæ‰€ä»¥æœ¬ç« åšåˆå¹¶ä»‹ç»ã€‚

#### å¦‚ä½•é€‰æ‹©ESModule ä¸ CommonJSäº§ç‰©

>ESModule æ˜¯ JavaScript ä½¿ç”¨çš„æ¨¡å—è§„èŒƒï¼Œè€Œ CommonJS æ˜¯ Node.js ä½¿ç”¨çš„æ¨¡å—è§„èŒƒï¼Œè¿™æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¾“å‡ºä»€ä¹ˆäº§ç‰©ï¼Œåªéœ€è¦æ ¹æ®ä½¿ç”¨æƒ…å†µåˆ¤æ–­å³å¯ï¼š

| äº§ç‰©ç±»å‹/è¿è¡Œç¯å¢ƒ | Browser | Node.js  | Both    |
| ----------------- | ------- | -------- | ------- |
| ESModule          | âœ… æ¨è | æš‚ä¸æ¨è | âœ… æ¨è |
| CommonJS          | æ²¡å¿…è¦  | âœ… æ¨è  | âœ… æ¨è |

>é¢å¤–è¯´æ˜ï¼š

>1. ç”±äº Node.js ç¤¾åŒºçš„ Pure ESM æ¨è¿›[ä»æœ‰é˜»ç¢](https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c)ï¼Œæ‰€ä»¥ä¸ºäº†é€šç”¨æ€§è€ƒè™‘ï¼Œç›®å‰ä»ç„¶å»ºè®®å¤§å®¶ä¸º Node.js é¡¹ç›®äº§å‡º CommonJS äº§ç‰©ï¼Œæœªæ¥ father ä¹Ÿä¼šæ¨å‡ºåŒæ—¶äº§å‡º ESModule äº§ç‰©çš„å…¼å®¹æ–¹æ¡ˆï¼Œæ•¬è¯·æœŸå¾…
>2. å¯¹äº Browser è¿è¡Œç¯å¢ƒï¼ŒCommonJS äº§ç‰©æ˜¯æ²¡å¿…è¦çš„ï¼Œæ— è®ºå“ªç§æ¨¡å—æ„å»ºå·¥å…·éƒ½èƒ½å¸®æˆ‘ä»¬è§£æï¼ŒåŠ ä¸Š Vite è¿™ç±»ä½¿ç”¨åŸç”Ÿ ESModule äº§ç‰©çš„æ„å»ºå·¥å…·å·²ç»æˆç†Ÿï¼Œä½¿ç”¨ ESModule æ‰æ˜¯é¢å‘æœªæ¥çš„æœ€ä½³é€‰æ‹©
>3. Both æ˜¯æŒ‡æ„å»ºäº§ç‰©è¦åŒæ—¶ç”¨äº Browser å’Œ Node.js çš„é¡¹ç›®ï¼Œæ¯”å¦‚ react-domã€umi ç­‰

#### å¦‚ä½•æ„å»ºESModule ä¸ CommonJSäº§ç‰©

>åªéœ€è¦ä½¿ç”¨ `esm` åŠ `cjs` é…ç½®é¡¹ï¼Œå†æ‰§è¡Œ `father build` å³å¯äº§å‡º ESModule å’Œ CommonJS äº§ç‰©ï¼š

```js
// .fatherrc.js
export default {
  // ä»¥ä¸‹ä¸º esm é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  esm: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'browser', // é»˜è®¤æ„å»ºä¸º Browser ç¯å¢ƒçš„äº§ç‰©
    transformer: 'babel', // é»˜è®¤ä½¿ç”¨ babel ä»¥æä¾›æ›´å¥½çš„å…¼å®¹æ€§
  },
  // ä»¥ä¸‹ä¸º cjs é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  cjs: {
    input: 'src', // é»˜è®¤ç¼–è¯‘ç›®å½•
    platform: 'node', // é»˜è®¤æ„å»ºä¸º Node.js ç¯å¢ƒçš„äº§ç‰©
    transformer: 'esbuild', // é»˜è®¤ä½¿ç”¨ esbuild ä»¥è·å¾—æ›´å¿«çš„æ„å»ºé€Ÿåº¦
  },
};
```

#### Bundleæ¨¡å¼

>Bundle å³å°†æºç æ‰“åŒ…çš„æ„å»ºæ¨¡å¼ï¼Œå®ƒä»¥å…¥å£æ–‡ä»¶ä½œä¸ºèµ·ç‚¹ã€é€’å½’å¤„ç†å…¨éƒ¨çš„ä¾èµ–ï¼Œç„¶åå°†å®ƒä»¬åˆå¹¶è¾“å‡ºæˆæ„å»ºäº§ç‰©ã€‚ç›®å‰ç¤¾åŒºé‡Œçš„ [Webpack](https://webpack.js.org)ã€[Rollup](https://rollupjs.org/guide/en/) åŠæ—§ç‰ˆ father çš„ rollup æ¨¡å¼éƒ½æ˜¯å¯¹æºç åš Bundle æ„å»ºçš„æ„å»ºå·¥å…·ã€‚

>åœ¨ father 4 ä¸­ï¼Œä»…è¾“å‡º UMD äº§ç‰©æ—¶ä¼šä½¿ç”¨ Bundle æ„å»ºæ¨¡å¼ã€‚æ¥çœ‹ä¸€ä¸‹ father çš„ Bundle æ„å»ºæ¨¡å¼ä¼šå¦‚ä½•å·¥ä½œã€‚

>å‡å®šæœ‰è¿™æ ·çš„æºç ç»“æ„ï¼š

```bash
.
â””â”€â”€ src
    â”œâ”€â”€ index.less
    â””â”€â”€ index.tsx # æºç ä¸­å¼•å…¥ index.less
```

>é…åˆä»¥ä¸‹æ„å»ºé…ç½®ï¼š

```ts
export default {
  umd: { output: 'dist' },
};
```

>åˆ™ä¼šè¢« father è¾“å‡ºä¸ºï¼š

```bash
.
â””â”€â”€ dist
    â”œâ”€â”€ index.min.js
    â””â”€â”€ index.min.css
```

>å¯ä»¥å‘ç°ï¼Œåœ¨ Bundle æ¨¡å¼ä¸‹ï¼Œfather ä¼šå¯¹æºç è¿›è¡Œæ‰“åŒ…ï¼Œæœ€åè¾“å‡ºå‹ç¼©åçš„ JavaScript äº§ç‰©å’Œ CSS äº§ç‰©ã€‚

#### å¦‚ä½•é€‰æ‹©Bundle

>Bundle çš„äº§ç‰©å…·å¤‡æ›´å¥½çš„ä¸€ä½“æ€§ã€‚father ä¸­åªæœ‰ UMD äº§ç‰©æ˜¯ Bundle æ„å»ºæ¨¡å¼ï¼Œæ‰€ä»¥åœ¨éœ€è¦ UMD äº§ç‰©æ—¶å°±éšä¹‹é€‰æ‹©äº† Bundle æ„å»ºæ¨¡å¼ã€‚

#### æˆ‘æ„å»ºESModule äº§ç‰©åŠ CommonJS äº§ç‰©

fatheré»˜è®¤çš„é¡¹ç›®ï¼Œä¸‰ç§éƒ½æ„å»ºäº†
ä¿®æ”¹.fathrerc.ts

```ts
import { defineConfig } from 'father';

export default defineConfig({
  cjs: {},
  esm: {},
  prebundle: {},
});
```

æ‰§è¡Œ

```shell
npm run build
```

æ„å»ºåç”Ÿæˆäº†ä¸¤ä¸ªç›®å½•
![esäº§ç‰©åŠcjsäº§ç‰©](/styles/images/2022/esäº§ç‰©åŠcjsäº§ç‰©.png)
index.d.tsæ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ç±»å‹çš„å£°æ˜å®šä¹‰

```ts
declare function omit<T, K extends keyof T>(obj: T, fields: Array<K>): Omit<T, K>;
export default omit;
```

esmä¸‹çš„index.jsæ˜¯æ™®é€šjsè¯­æ³•çš„å‡½æ•°

```js
function omit(obj, fields) {
  var shallowCopy = Object.assign({}, obj);

  for (var i = 0; i < fields.length; i += 1) {
    var key = fields[i];
    delete shallowCopy[key];
  }

  return shallowCopy;
}

export default omit;
```

cjsä¸‹çš„index.jsä¸ºäº†nodejsç¯å¢ƒåšäº†å¾ˆå¤šå·¥ä½œ

```js
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.ts
var src_exports = {};
__export(src_exports, {
  default: () => src_default
});
module.exports = __toCommonJS(src_exports);
function omit(obj, fields) {
  const shallowCopy = Object.assign({}, obj);
  for (let i = 0; i < fields.length; i += 1) {
    const key = fields[i];
    delete shallowCopy[key];
  }
  return shallowCopy;
}
var src_default = omit;
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {});
```

#### æ„å»º UMD äº§ç‰©

#### å¦‚ä½•é€‰æ‹©UMD

åªæœ‰åœ¨æ»¡è¶³å¦‚ä¸‹ä»»æ„æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæ‰éœ€è¦é€‰æ‹©è¾“å‡º UMD äº§ç‰©ï¼š

1. é¡¹ç›®çš„ç”¨æˆ·å¯èƒ½éœ€è¦å°†è¯¥ä¾èµ–åš external å¤„ç†ã€å¹¶åœ¨ HTML ä¸­é€šè¿‡ script æ ‡ç­¾ç›´æ¥å¼•å…¥ CDN ä¸Šçš„äº§ç‰©ï¼ˆç±»ä¼¼ React æˆ– antdï¼‰
2. é¡¹ç›®éœ€è¦äº§å‡ºç¼–è¯‘åçš„æ ·å¼è¡¨ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œä¾‹å¦‚å°† Less æ–‡ä»¶ä»¥ç‰¹å®šçš„å˜é‡ç¼–è¯‘æˆ CSS æ–‡ä»¶ï¼Œå¸¸è§äºåŸºäº antdã€åˆéœ€è¦è‡ªå®šä¹‰ä¸»é¢˜çš„ç»„ä»¶åº“

#### å¦‚ä½•æ„å»ºUMD

åªéœ€è¦ä½¿ç”¨ `umd` é…ç½®é¡¹ï¼Œå†æ‰§è¡Œ `father build` å³å¯äº§å‡º UMD äº§ç‰©ï¼š

```js
// .fatherrc.js
export default {
  // ä»¥ä¸‹ä¸º umd é…ç½®é¡¹å¯ç”¨æ—¶çš„é»˜è®¤å€¼ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  umd: {
    entry: 'src/index', // é»˜è®¤æ„å»ºå…¥å£æ–‡ä»¶
  },
};
```

æ›´å¤šé…ç½®é¡¹å¯å‚è€ƒ [é…ç½®é¡¹](../config.md)ã€‚

åœ¨ father é¡¹ç›®ä¸­ï¼ŒUMD äº§ç‰©ä»¥ Bundle æ¨¡å¼è¿›è¡Œæ„å»ºï¼Œå…³äº Bundle æ¨¡å¼çš„ä»‹ç»å¯å‚è€ƒ [æ„å»ºæ¨¡å¼ - Bundle](./build-mode.md#bundle)ã€‚

#### æˆ‘æ„å»ºudmäº§ç‰©

é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªumd

```js
import { defineConfig } from 'father';

export default defineConfig({
  cjs: {},
  esm: {},
  umd: {},
  prebundle: {},
});
```

æ„å»ºååªæœ‰ä¸€ä¸ªjs
![umdäº§ç‰©](/styles/images/2022/umdäº§ç‰©.png)
å†…å®¹ä¸º

```js
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var n in o)("object"==typeof exports?exports:e)[n]=o[n]}}(self,(function(){return function(){"use strict";var e={r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};return e.r(t),t.default=function(e,t){for(var o=Object.assign({},e),n=0;n<t.length;n+=1){delete o[t[n]]}return o},t}()}));
```

æ˜¯ä¸€ä¸ªå‹ç¼©åçš„js

### ä¾èµ–é¢„æ‰“åŒ…ï¼ˆå®éªŒæ€§ï¼‰

> æ³¨æ„ï¼šä¾èµ–é¢„æ‰“åŒ…**ä»…é€‚ç”¨äº Node.js é¡¹ç›®**ï¼Œé¢å‘ Browser çš„é¡¹ç›®è¯·å‹¿ä½¿ç”¨

>ä¾èµ–é¢„æ‰“åŒ…æ˜¯æŒ‡å°†é¡¹ç›®çš„ä¾èµ–ã€ä»¥åŠä¾èµ–çš„ä¾èµ–ï¼Œæå‰ç¼–è¯‘æˆé¡¹ç›®çš„äº§ç‰©ä¹‹ä¸€ï¼Œè€Œé¡¹ç›®çš„æºç ä¹Ÿæ”¹ä¸ºç›´æ¥ä»é¢„æ‰“åŒ…äº§ç‰©ä¸­å¼•å…¥ä¾èµ–ã€‚

>è¿™æ˜¯è¿‘å¹´æ¥ç¤¾åŒº Node.js é¡¹ç›®æµè¡Œçš„ä¾èµ–å¤„ç†æ–¹å¼ï¼Œå®ƒå¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥ä»¥ä¸‹ä¼˜ç‚¹ï¼š

>1. **NPM åŒ…å‘å¸ƒåå®‰è£…ä½“ç§¯æ›´å°ã€é€Ÿåº¦æ›´å¿«**ã€‚ç”±äº NPM åŒ…çš„ä¾èµ–æ ‘å¾€å¾€ååˆ†å¤æ‚ï¼Œæˆ‘ä»¬ä¾èµ–çš„åªæ˜¯ A è¿™æ£µæ ‘ï¼Œå®‰è£…çš„å´å¯èƒ½æ˜¯ä¸€ç‰‡æ£®æ—ï¼Œä½†å´ä¸æ˜¯æ¯æ£µæ ‘éƒ½ä¼šè¢«ç”¨åˆ°ã€‚è€Œä¾èµ–é¢„æ‰“åŒ…èƒ½å°†ä¾èµ–æ‰“åŒ…æˆå•ä¸ªæ–‡ä»¶ï¼Œè®©ä¸€ç‰‡æ£®æ—å‹ç¼©æˆä¸€æ£µå¤§æ ‘ï¼Œå†è·Ÿéšæˆ‘ä»¬çš„é¡¹ç›®ä¸€èµ·å‘å¸ƒ NPMï¼Œè¾¾åˆ°ä½“ç§¯æ›´å°ã€é€Ÿåº¦æ›´å¿«çš„ç›®çš„ã€‚
>2. **æå‡é¡¹ç›®ç¨³å®šæ€§**ã€‚ç›¸ä¿¡å¤§å®¶éƒ½ç¢°åˆ°è¿‡ã€æ˜¨å¤©è¿˜å¥½å¥½çš„ï¼Œä»Šå¤©æ€ä¹ˆå°±æŒ‚äº†ã€çš„æƒ…å†µï¼Œå³ä¾¿åº•å±‚ä¾èµ–çš„æ›´æ–°å†å°å¿ƒç¿¼ç¿¼ï¼Œä¹Ÿæ— æ³•éªŒè¯ä¸Šå±‚é¡¹ç›®çš„æ‰€æœ‰åœºæ™¯ï¼Œæ›´ä½•å†µæœ‰äº›åº•å±‚ä¾èµ–å‘ç‰ˆè¿˜ä¸ä¸€å®šéµå¾ª semver çš„çº¦å®šã€‚è€Œä¾èµ–é¢„æ‰“åŒ…å¯ä»¥å°†ã€åº•å±‚ä¾èµ–æ›´æ–°ã€è¿™ä»¶äº‹ç”±è¢«åŠ¨å˜ä¸ºä¸»åŠ¨ï¼Œéœ€è¦æ›´æ–°çš„æ—¶å€™æˆ‘ä»¬å†é‡æ–°é¢„æ‰“åŒ…ä¸€ä»½ä¾¿æ˜¯ï¼Œä»è€Œå¤§å¤§æå‡é¡¹ç›®ç¨³å®šæ€§ã€‚
>3. **NPM åŒ…å‘å¸ƒåå®‰è£… 0 warning**ã€‚ç”±äº NPM å®‰è£…ä¼šè¿›è¡Œ `peerDependencies` çš„æ ¡éªŒï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„è­¦å‘Šï¼Œä¾èµ–é¢„æ‰“åŒ…åä¸éœ€è¦å®‰è£…ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æˆ‘ä»¬çš„ NPM åŒ…æ—¶ä¹Ÿä¸ä¼šå†çœ‹åˆ°è­¦å‘Šä¿¡æ¯äº†ã€‚è€Œæˆ‘ä»¬ä½œä¸º NPM åŒ…å¼€å‘è€…ï¼Œåœ¨å¼€å‘é˜¶æ®µå®‰è£…çš„æ—¶å€™ä»ç„¶æ˜¯å¯ä»¥å®¡æŸ¥è¿™äº›è­¦å‘Šä¿¡æ¯çš„ã€‚

>ä½†ä¾èµ–é¢„æ‰“åŒ…è¦å¤„ç†çš„æƒ…å†µå¾€å¾€æ¯”æƒ³è±¡ä¸­å¤æ‚ï¼Œæˆ‘ä»¬ä¼šé‡åˆ° `dynamic require/import`ï¼Œä¹Ÿä¼šé‡åˆ°ç›¸é‚»äº§ç‰©æ–‡ä»¶çš„è¯»å–ï¼Œè¿™éƒ½å¯èƒ½ä½¿å¾—ä¾èµ–é¢„æ‰“åŒ…å¤±è´¥ã€æˆ–è€…äº§ç‰©ä¸å¯ç”¨ã€‚

>father å·²ç»å°½å¯èƒ½åœ°åœ¨å¤„ç†è¿™äº› caseï¼Œä½†ä»ç„¶æ”¹å˜ä¸äº†å®ƒ**ç°é˜¶æ®µåªèƒ½ä½œä¸ºå®éªŒæ€§åŠŸèƒ½**çš„äº‹å®ï¼Œæ‰€ä»¥è¯·è°¨æ…åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ä¾èµ–é¢„æ‰“åŒ…èƒ½åŠ›ï¼Œä¹Ÿæ¬¢è¿å°†é‡åˆ°çš„é—®é¢˜åé¦ˆåˆ° [issue](https://github.com/umijs/father-next/issues/28) ä¸­ã€å¸®åŠ© father æ”¹è¿›ã€‚

>å»¶ä¼¸é˜…è¯»ï¼š[äº‘è°¦å…¬ä¼—å·æ–‡ç« ï¼šcoa å’Œä¾èµ–é”å®š](https://mp.weixin.qq.com/s/KbmpzvoB1yJlNDEO1p_fJQ)

#### å¦‚ä½•æ„å»ºé¢„æ‰“åŒ…

>åªéœ€è¦ä½¿ç”¨ `prebundle` é…ç½®é¡¹ï¼Œå†æ‰§è¡Œ `father prebundle` å³å¯äº§å‡ºä¾èµ–é¢„æ‰“åŒ…äº§ç‰©ï¼š

```js
// .fatherrc.js
export default {
  prebundle: {
    deps: ['pkg-a', 'pkg-b'], // éœ€è¦é¢„æ‰“åŒ…çš„ä¾èµ–åŒ…åï¼Œéœ€è¦å®‰è£…åœ¨ `devDependencies` ä¸­
    output: 'compiled', // é»˜è®¤è¾“å‡ºç›®å½•ï¼Œæœ‰è‡ªå®šä¹‰éœ€æ±‚æ—¶æ‰éœ€é…ç½®
  },
};
```

é¡¹ç›®æ²¡æœ‰å¤ªå¤šä¾èµ–ï¼Œå…ˆå¿½ç•¥è¿™éƒ¨åˆ†

### æ›´æ–°ç‰ˆæœ¬å·

ä½¿ç”¨ npm version å‘½ä»¤æ›´æ–°ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ï¼š

#### å‘å¸ƒä¸€ä¸ª patch ç‰ˆæœ¬

```shell
npm version patch -m "build: release %s"
```

è¯¥å‘½ä»¤å°†ä¼šè‡ªåŠ¨ç”Ÿæˆ git tag åŠ git commitï¼Œå¹¶å°†ç‰ˆæœ¬å·æ›´æ–°åˆ° package.json ä¸­ã€‚æ›´å¤šç”¨æ³•å¯å‚è€ƒ NPM æ–‡æ¡£ï¼š<https://docs.npmjs.com/cli/v8/commands/npm-version>

### é¡¹ç›®ä½“æ£€

father çš„é¡¹ç›®ä½“æ£€èƒ½åŠ›å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç°é¡¹ç›®çš„æ½œåœ¨é—®é¢˜ï¼Œå¹¶æä¾›æ”¹è¿›å»ºè®®ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
father doctor // npm run prepublishOnly 
```

ç»“æœè¿˜æ˜¯æ¯”è¾ƒok

```bash
*  æ­£åœ¨æ‰§è¡Œä»»åŠ¡: npm run prepublishOnly 


> omit-f.js@0.0.1 prepublishOnly
> father doctor && npm run build

ï¿½ğŸ‰ This project looks fine!

> omit-f.js@0.0.1 build
> father build

info  - Clean output directories
info  - Bundless for src directory to cjs format
event - Bundless src/index.ts to dist\cjs\index.js (with declaration)
event - Generate declaration file...
event - Transformed successfully in 1264 ms (1 files)
 *  ç»ˆç«¯å°†è¢«ä»»åŠ¡é‡ç”¨ï¼ŒæŒ‰ä»»æ„é”®å…³é—­ã€‚ 
```

### å‘å¸ƒ

æ‰§è¡Œ `npm whoami` æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œå¦‚æœæœªç™»å½•åˆ™æ‰§è¡Œ `npm login`æ£€æŸ¥ package.json ä¸­çš„ NPM åŒ…ååŠ publishConfig æ˜¯å¦ç¬¦åˆé¢„æœŸ.`npm publish`å‘å¸ƒ

![publishLog](/styles/images/2022/publishLog.png)
ç›´æ¥å°±å‘å¸ƒæˆåŠŸäº†ï¼Œå·¥å…·è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚

è¿™é‡Œä¹‹å‰åˆ›å»ºçš„æ—¶å€™é€‰çš„æ˜¯nodejsç¯å¢ƒï¼Œæ‰€ä»¥package.jsonä¸­å‘å¸ƒçš„å…¶å®åªæœ‰cjsåŒ…

```json
"main": "dist/cjs/index.js",
"types": "dist/cjs/index.d.ts",
```

å‚è€ƒæ–‡æ¡£:
[father](https://github.com/umijs/father/blob/HEAD/docs/guide/index.md)

### åç½®å·¥ä½œ

>**åŠŸèƒ½éªŒè¯ï¼š**ä½¿ç”¨æµ‹è¯•é¡¹ç›®ä¸‹è½½æ–°å‘å¸ƒçš„ NPM åŒ…ï¼ŒéªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸
>**æ›´æ–°æ—¥å¿—ï¼š**å°†æœ¬æ¬¡å‘å¸ƒçš„å˜æ›´é€šè¿‡ GitHub çš„ Release Page è¿›è¡Œæè¿°ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨å‰ç½®å·¥ä½œä¸­å°†å˜æ›´æè¿°å†™å…¥ CHANGELOG.md æ–‡ä»¶ï¼ˆæœªæ¥ father ä¼šæä¾›è‡ªåŠ¨åŒ–çš„æ›´æ–°æ—¥å¿—ç”Ÿæˆèƒ½åŠ›ï¼Œæ•¬è¯·æœŸå¾…ï¼‰

## é€šè¿‡æµ‹è¯•ç”¨ä¾‹è°ƒè¯•æºç 

>å…³äºå¦‚ä½•è°ƒè¯•çœ‹è¿™ç¯‡ï¼š[æ–°æ‰‹å‘ï¼šå‰ç«¯ç¨‹åºå‘˜å¿…å­¦åŸºæœ¬æŠ€èƒ½â€”â€”è°ƒè¯•JSä»£ç ](https://juejin.cn/post/7030584939020042254)

çœ‹äº†ä¸€ä¸‹ï¼Œè¿™éƒ¨åˆ†çš„è°ƒè¯•ä¸»è¦æ˜¯é’ˆå¯¹ä½¿ç”¨vscodeç¼–è¾‘å™¨æ¥è°ƒè¯•æºç 

æŸ¥çœ‹package.jsonï¼Œæ‰¾åˆ°testå‘½ä»¤

```json
"scripts": {
    "start": "father doc dev --storybook",
    "build": "father doc build --storybook",
    "compile": "father build",
    "gh-pages": "father doc deploy",
    "prepublishOnly": "npm run compile && np --yolo --no-publish",
    "lint": "eslint .",
    "test": "father test",
    "coverage": "father test --coverage"
  },
```

é€šè¿‡`npm run test`æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹

```bash
> omit.js@2.0.2 test
> father test

 PASS  tests/index.test.js
  omit
    âˆš should create a shallow copy (2ms)
    âˆš should drop fields which are passed in

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        50.254s
Ran all test suites.
```

æ‰§è¡Œçš„æ˜¯tests/index.test.jsï¼Œæµ‹è¯•ä»£ç å¾ˆæ˜æ˜¾åœ¨testsç›®å½•ä¸‹æ–¹

```js
import assert from 'assert';
import omit from '../src';

describe('omit', () => {
  it('should create a shallow copy', () => {
    const benjy = { name: 'Benjy' };
    const copy = omit(benjy, []);
    assert.deepEqual(copy, benjy);
    assert.notEqual(copy, benjy);
  });

  it('should drop fields which are passed in', () => {
    const benjy = { name: 'Benjy', age: 18 };
    assert.deepEqual(omit(benjy, ['age']), { name: 'Benjy' });
    assert.deepEqual(omit(benjy, ['name', 'age']), {});
  });
});
```

ä¹Ÿå°±æ˜¯è¯´fatheré›†æˆäº†jestæµ‹è¯•å·¥å…·ã€‚
è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨äº†assertä¸­çš„å‡½æ•°æ¥æµ‹è¯•ï¼ŒæŸ¥çœ‹deepEqual

```js
function _deepEqual(actual, expected, strict, memos) {
  // 7.1. All identical values are equivalent, as determined by ===.
  if (actual === expected) {
    return true;
  } else if (isBuffer(actual) && isBuffer(expected)) {
    return compare(actual, expected) === 0;

  // 7.2. If the expected value is a Date object, the actual value is
  // equivalent if it is also a Date object that refers to the same time.
  } else if (util.isDate(actual) && util.isDate(expected)) {
    return actual.getTime() === expected.getTime();

  // 7.3 If the expected value is a RegExp object, the actual value is
  // equivalent if it is also a RegExp object with the same source and
  // properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).
  } else if (util.isRegExp(actual) && util.isRegExp(expected)) {
    return actual.source === expected.source &&
           actual.global === expected.global &&
           actual.multiline === expected.multiline &&
           actual.lastIndex === expected.lastIndex &&
           actual.ignoreCase === expected.ignoreCase;

  // 7.4. Other pairs that do not both pass typeof value == 'object',
  // equivalence is determined by ==.
  } else if ((actual === null || typeof actual !== 'object') &&
             (expected === null || typeof expected !== 'object')) {
    return strict ? actual === expected : actual == expected;

  // If both values are instances of typed arrays, wrap their underlying
  // ArrayBuffers in a Buffer each to increase performance
  // This optimization requires the arrays to have the same type as checked by
  // Object.prototype.toString (aka pToString). Never perform binary
  // comparisons for Float*Arrays, though, since e.g. +0 === -0 but their
  // bit patterns are not identical.
  } else if (isView(actual) && isView(expected) &&
             pToString(actual) === pToString(expected) &&
             !(actual instanceof Float32Array ||
               actual instanceof Float64Array)) {
    return compare(new Uint8Array(actual.buffer),
                   new Uint8Array(expected.buffer)) === 0;

  // 7.5 For all other Object pairs, including Array objects, equivalence is
  // determined by having the same number of owned properties (as verified
  // with Object.prototype.hasOwnProperty.call), the same set of keys
  // (although not necessarily the same order), equivalent values for every
  // corresponding key, and an identical 'prototype' property. Note: this
  // accounts for both named and indexed properties on Arrays.
  } else if (isBuffer(actual) !== isBuffer(expected)) {
    return false;
  } else {
    memos = memos || {actual: [], expected: []};

    var actualIndex = memos.actual.indexOf(actual);
    if (actualIndex !== -1) {
      if (actualIndex === memos.expected.indexOf(expected)) {
        return true;
      }
    }

    memos.actual.push(actual);
    memos.expected.push(expected);

    return objEquiv(actual, expected, strict, memos);
  }
}
```

æ˜¯ä¸€ä¸ªæ·±å±‚å¯¹æ¯”ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸åŒçš„å‡½æ•°ï¼Œåˆ¤æ–­å„ç§ç±»å‹ï¼Œç„¶ååˆ†åˆ«æ ¹æ®ä¸¤ç§ç±»å‹æ¥å¯¹æ¯”

## é€‰å­¦

ç±»ä¼¼ TS Omit å‚è€ƒæ–‡ç«  zhuanlan.zhihu.com/p/397398407
underscore.js ä¹Ÿæœ‰è¿™ä¸ªæ–¹æ³• omit underscorejs.org/docs/moduleâ€¦
lodash ä¹Ÿæœ‰ omit docs-lodash.com/v4/omit/
